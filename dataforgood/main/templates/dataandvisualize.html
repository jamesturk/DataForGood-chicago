<html>
    <head>
        <title> Data & Visualize </title>
        <style>
            body{
                background:white;
                font-family:arial;
            }

            h1{
                font-size:40px;
                text-align: center;
                padding: 10px;
            }
            h3{
                margin: 20px 20px 30px;
                font-size:25px;
            }
            h4{
                font-size:18px;
            }
            caption{
                font-size:18px;
                margin: 0px 5px 10px;
                font-weight: bold;
            }

            .table1{
                max-width:2000px;
                margin: 20px 20px 20px;
                border-collapse: collapse;
                border-radius:0px;
                border-spacing:5px;
                background: white;
                padding:10px;
                font-size:1em;
            }
            td, th {
            padding: 1rem;
            }
            .table2{
                max-width:500px;
                margin: 0px 20px 20px;
                border-collapse: collapse;
                border-radius:0px;
                border-spacing:5px;
                background: white;
                padding:10px;
                font-size:1em;
                align-items: center;
                float: left;
            }
            .maintable{
                max-width:700px;
                background: rgb(255, 205, 163);
                margin: 20px 20px 50px;
                padding:10px;
            }
            .subtable{
                background: rgb(248, 213, 153);
                max-width:1250px;
                margin: 20px 20px 50px;
                padding:10px;
                height: 600;
            }

            .query-form{
                display: inline-block;
                max-width:300px;
                margin: 10px 20px 30px;
                border-radius:5px;
                background: lightgrey;
                padding:10px;
                font-size:1em;
            }
            .scrollable-checkbox-list {
                height: 150px; 
                overflow-y: scroll;; /* Enables vertical scrolling */
                border: 1px solid #ccc; 
                padding: 10px;
                border-radius: 5px; 
                background-color: white;
                margin-bottom: 10px;
            }
            .year-select {
                padding: 10px;
                border-radius: 5px; 
                background-color: white;
                margin-bottom: 10px;
            }
    
            input[type=text], select{
                width:100%;
                padding:12px 20px;
                margin:8px 0;
                border:1px solid #ccc;
                border-radius:4px;
                box-sizing:border-box;
                font-size:1em;
            }
            input[type=submit]{
                width:100%;
                background:black;
                color: white;
                padding:5px 10px;
                margin: 10px 0;
                border: none;
                border-radius:4px;
                cursor:pointer;
                font-size:0.9em;
            }
            input[type=submit]:hover{
                background:darkgreen;
                font-size:0.9em;
            }

            details {
            border: 1px solid #767676;
            background: lightgrey;
            border-radius: 3px;
            display: inline-flex;
            flex-direction: column;
            padding: 10px 10px;
            }

            details summary::marker {
            display: none;
            font-size: 0;
            }

            details summary::-webkit-details-marker {
            display: none;
            font-size: 0;
            }

            details summary::after {
            content: "\25BC";
            display: inline-block;
            font-size: 0.6rem;
            height: 1rem;
            line-height: 1rem;
            margin-left: 0.5rem;
            position: relative;
            transition: transform 0.25s;
            }

            details[open] summary {
            margin-bottom: 1rem;
            }

            details[open] summary::after {
            top: -0.15rem;
            transform: rotate(180deg);
            }

            fieldset {
            border: 0;
            padding: 0;
            }

            fieldset legend {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0, 0, 0, 0) !important;
            white-space: nowrap !important;
            border: 0 !important;
            }

            ul {
            list-style: none;
            margin: 0;
            padding: 0;
            }

            ul li {
            border-radius: 3px;
            margin: 0;
            padding: 4px 2px;
            }

            ul li:hover {
            background: #eee;
            }

            ul li label {
            display: inline-block;
            width: 8rem;
            }


        </style>
    </head>
    <h1> Data & Visualize </h1>
    <body>

        <header>
            <nav>
                <div class="logo">Data For Good - Chicago</div>
                <ul class="nav-links">
                    <li><a href="{% url 'aboutus' %}">About Us</a></li>
                    <li><a href="{% url 'dataandvisualize' %}">Data & Visualize</a></li>
                    <li><a href="{% url 'resources' %}">Resource</a></li>
                </ul>
            </nav>
        </header>

        <div class="query-form">
            <h4> Search Database </h4>
            <form class="SearchForm" method="GET", enctype="multipart/form-data">
                {% csrf_token %}
                <p>{{ form.geographic_level.label_tag }}{{ form.geographic_level }}</p>
                <div class="scrollable-checkbox-list" id="tract_field">
                    <input type="checkbox" id="select_all_tract" onclick="toggleTractSelection(this)">
                    <label for="select_all_tract">Select All/Remove All</label>
                    {{ form.tract }}
                </div>
                <div class="scrollable-checkbox-list" id="zipcode_field">
                    <input type="checkbox" id="select_all_zipcode" onclick="toggleZipcodeSelection(this)">
                    <label for="select_all_zipcode">Select All/Remove All</label>
                    {{ form.zipcode }}
                </div>
                <div class="scrollable-checkbox-list" id="community_field">{{ form.community }}</div>
                <p>{{ form.category.label_tag }}{{ form.category }}</p>
                <p>{{ form.indicator.label_tag }}</p>
                <div  id="economic_field" style="display:none;">{{ form.economic_indicators }}</div>
                <div id="education_field" style="display:none;">{{ form.education_indicators }}</div>
                <div id="health_field" style="display:none;">{{ form.health_indicators }}</div>
                <div  id="housing_field" style="display:none;">{{ form.housing_indicators }}</div>
                <div  id="population_field" style="display:none;">{{ form.population_indicators }}</div>
                <div>
                    <p>{{ form.year.label_tag }}
                    <input type="checkbox" id="select_all_years" onclick="toggleYearSelection(this)">
                    <label for="select_all_years">Select All/Remove All</label>
                    </p>
                </div>
                <div class="year-select">
                    {% for checkbox in form.year %}
                        <label>{{ checkbox.tag }} {{ checkbox.choice_label }}</label><br>
                    {% endfor %}
                </div>
            <button type="submit"> Submit </button>
            </form>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const geoLevelSelect = document.getElementById('id_geographic_level');
                const tractField = document.getElementById('tract_field');
                const zipcodeField = document.getElementById('zipcode_field');
                const communityField = document.getElementById('community_field');

                const categorySelect = document.getElementById('id_category');
                const economicField = document.getElementById('economic_field');
                const educationField = document.getElementById('education_field');
                const healthField = document.getElementById('health_field');
                const housingField = document.getElementById('housing_field');
                const populationField = document.getElementById('population_field');



                function handleGeoLevelChange() {
                    const selectedValue = geoLevelSelect.value;
                    // Hide all fields initially
                    tractField.style.display = 'none';
                    zipcodeField.style.display = 'none';
                    communityField.style.display = 'none';
                    // Show relevant field based on the selection
                    if (selectedValue === 'Tract') {
                        tractField.style.display = 'block';
                    } else if (selectedValue === 'Zipcode') {
                        zipcodeField.style.display = 'block';
                    } else if (selectedValue == 'Community') {
                        communityField.style.display = 'block';
                    }
                }
                geoLevelSelect.addEventListener('change', handleGeoLevelChange);
                handleGeoLevelChange();

                function handleIndicatorChange() {
                    const selectedValue = categorySelect.value;
                    // Hide all fields initially
                    economicField.style.display = 'none';
                    educationField.style.display = 'none';
                    healthField.style.display = 'none';
                    housingField.style.display = 'none';
                    populationField.style.display = 'none';
                    // Show relevant field based on the selection
                    if (selectedValue === 'Economic') {
                        economicField.style.display = 'block';
                    } else if (selectedValue === 'Education') {
                        educationField.style.display = 'block';
                    } else if (selectedValue === 'Health') {
                        healthField.style.display = 'block';
                    } else if (selectedValue == 'Housing') {
                        housingField.style.display = 'block';
                    } else if (selectedValue == 'Population') {
                        populationField.style.display = 'block';
                    }
                }
                categorySelect.addEventListener('change', handleIndicatorChange);
                handleIndicatorChange();
            });

            // function to select/remove all for years
            function toggleYearSelection(source) {
                checkboxes = document.querySelectorAll('[name="year"]');
                for(var i = 0, n = checkboxes.length; i < n; i++) {
                    checkboxes[i].checked = source.checked;
                }
            };

            // function to select/remove all for tracts
            function toggleTractSelection(source) {
                var checkboxes = document.querySelectorAll('input[name="tract"]');
                for (var i = 0, n = checkboxes.length; i < n; i++) {
                    checkboxes[i].checked = source.checked;
                }
            };

            // function to select/remove all for zipcodes
            function toggleZipcodeSelection(source) {
                var checkboxes = document.querySelectorAll('input[name="zipcode"]');
                for (var i = 0, n = checkboxes.length; i < n; i++) {
                    checkboxes[i].checked = source.checked;
                }
            };
            </script>

        <div class="maintable" id="table"">
            <h3> {{table_title}} </h3>
            <table class="table1" border="1">
                <tr>
                    {% for header in field.headers %}
                        <th> {{ header }} </th>
                    {% endfor %}
                    {% for row in field.rows %}
                    <tr>
                        {% for value in row %}
                            <td>{{value}}</td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </table>
        </div>
        <div id="chart-container"></div>

        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var chartData = {{ chart_data|safe }};

                Highcharts.chart('chart-container', {
                    chart: {
                        type: 'column'
                    },
                    title: {
                        text: '{{ table_title }}'
                    },
                    xAxis: {
                        categories: chartData.categories
                    },
                    yAxis: {
                        title: {
                            text: 'Value'
                        }
                    },
                    series: chartData.series
                });
            });
        </script>
        <div class="subtable" id="table">
            <h3>By Subgroups</h3>

            <form id="subgroup-form">
                {{ subgroup_form.as_p }}
                <input type="submit" value="Submit">
            </form>

            <table class="table2" border="1">
                <caption id="subtable-year"></caption>
                <thead>
                    <tr id="subtable-headers"></tr>
                </thead>
                <tbody id="subtable-rows"></tbody>
            </table>
        </div>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function() {
                var multiYearSubtableField = {{ multi_year_subtable_field|safe }};

                // Function to update the subgroup table based on the selected year
                function updateSubgroupTable(year) {
                    var subtableData = multiYearSubtableField[year];
                    $('#subtable-year').text(year);
                    $('#subtable-headers').empty();
                    $('#subtable-rows').empty();

                    subtableData.headers.forEach(function(header) {
                        $('#subtable-headers').append('<th>' + header + '</th>');
                    });

                    subtableData.rows.forEach(function(row) {
                        var rowHtml = '<tr>';
                        row.forEach(function(value) {
                            rowHtml += '<td>' + value + '</td>';
                        });
                        rowHtml += '</tr>';
                        $('#subtable-rows').append(rowHtml);
                    });
                }

                $('#subgroup-form').submit(function(event) {
                    event.preventDefault();
                    var selectedYear = $('#id_subgroup_year').val();
                    updateSubgroupTable(selectedYear);
                });

                var initialYear = '{{ subgroup_form.subgroup_year.value }}';
                updateSubgroupTable(initialYear);
            });
        </script>

        <div class="maintable">
            <h3> Total Population </h3>
            <table class="table1" border="1">
                <tr>
                    <th>Zipcode</th>
                    <th>2016</th>
                    <th>2017</th>
                    <th>2018</th>
                    <th>2019</th>
                    <th>2020</th>
                    <th>2021</th>
                </tr>
                <tr>
                    <th>60601</th>
                        <td>210,000</td>
                        <td>220,000</td>
                        <td>230,000</td>
                        <td>240,000</td>
                        <td>250,000</td>
                        <td>260,000</td>
                </tr>
                <tr>
                    <th>60602</th>
                        <td>210,000</td>
                        <td>220,000</td>
                        <td>230,000</td>
                        <td>240,000</td>
                        <td>250,000</td>
                        <td>260,000</td>
                </tr>
                <tr>
                    <th>60603</th>
                        <td>210,000</td>
                        <td>220,000</td>
                        <td>230,000</td>
                        <td>240,000</td>
                        <td>250,000</td>
                        <td>260,000</td>
                </tr>
            </table>
        </div>
        <div class="subtable">
            <h3> By Race Groups </h3>
            <table class="table2" border="1">
                <caption> 2016 </caption>
                <tr>
                    <th>Zipcode</th>
                    <th>60601</th>
                    <th>60602</th>
                    <th>6063</th>
                </tr>
                <tr>
                    <th>Black</th>
                        <td>300,000</td>
                        <td>310,000</td>
                        <td>320,000</td>
                </tr>
                <tr>
                    <th>White</th>
                        <td>100,000</td>
                        <td>150,000</td>
                        <td>160,000</td>
                </tr>
                <tr>
                    <th>Asian</th>
                        <td>30,000</td>
                        <td>32,000</td>
                        <td>35,000</td>
                </tr>
            </table>

            <table class="table2" border="1">
                <caption> 2017 </caption>
                <tr>
                    <th>Zipcode</th>
                    <th>60601</th>
                    <th>60602</th>
                    <th>6063</th>
                </tr>
                <tr>
                    <th>Black</th>
                        <td>300,000</td>
                        <td>310,000</td>
                        <td>320,000</td>
                </tr>
                <tr>
                    <th>White</th>
                        <td>100,000</td>
                        <td>150,000</td>
                        <td>160,000</td>
                </tr>
                <tr>
                    <th>Asian</th>
                        <td>30,000</td>
                        <td>32,000</td>
                        <td>35,000</td>
                </tr>
            </table>

            <table class="table2" border="1">
                <caption> 2018 </caption>
                <tr>
                    <th>Zipcode</th>
                    <th>60601</th>
                    <th>60602</th>
                    <th>6063</th>
                </tr>
                <tr>
                    <th>Black</th>
                        <td>300,000</td>
                        <td>310,000</td>
                        <td>320,000</td>
                </tr>
                <tr>
                    <th>White</th>
                        <td>100,000</td>
                        <td>150,000</td>
                        <td>160,000</td>
                </tr>
                <tr>
                    <th>Asian</th>
                        <td>30,000</td>
                        <td>32,000</td>
                        <td>35,000</td>
                </tr>
            </table>

            <table class="table2" border="1">
                <caption> 2019 </caption>
                <tr>
                    <th>Zipcode</th>
                    <th>60601</th>
                    <th>60602</th>
                    <th>6063</th>
                </tr>
                <tr>
                    <th>Black</th>
                        <td>300,000</td>
                        <td>310,000</td>
                        <td>320,000</td>
                </tr>
                <tr>
                    <th>White</th>
                        <td>100,000</td>
                        <td>150,000</td>
                        <td>160,000</td>
                </tr>
                <tr>
                    <th>Asian</th>
                        <td>30,000</td>
                        <td>32,000</td>
                        <td>35,000</td>
                </tr>
            </table>

            <table class="table2" border="1">
                <caption> 2020 </caption>
                <tr>
                    <th>Zipcode</th>
                    <th>60601</th>
                    <th>60602</th>
                    <th>6063</th>
                </tr>
                <tr>
                    <th>Black</th>
                        <td>300,000</td>
                        <td>310,000</td>
                        <td>320,000</td>
                </tr>
                <tr>
                    <th>White</th>
                        <td>100,000</td>
                        <td>150,000</td>
                        <td>160,000</td>
                </tr>
                <tr>
                    <th>Asian</th>
                        <td>30,000</td>
                        <td>32,000</td>
                        <td>35,000</td>
                </tr>
            </table>

            <table class="table2" border="1">
                <caption> 2021 </caption>
                <tr>
                    <th>Zipcode</th>
                    <th>60601</th>
                    <th>60602</th>
                    <th>6063</th>
                </tr>
                <tr>
                    <th>Black</th>
                        <td>300,000</td>
                        <td>310,000</td>
                        <td>320,000</td>
                </tr>
                <tr>
                    <th>White</th>
                        <td>100,000</td>
                        <td>150,000</td>
                        <td>160,000</td>
                </tr>
                <tr>
                    <th>Asian</th>
                        <td>30,000</td>
                        <td>32,000</td>
                        <td>35,000</td>
                </tr>
            </table>
        </div>

    </body>
</html>
